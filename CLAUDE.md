# CLAUDE.md

This document explains how to work on this repository with a readability-first approach while preserving behavior.

## Working Rules
- Keep changes focused and avoid broad rewrites that are not requested.
- Prefer clearer structure over clever code.
- Reuse existing patterns before adding new abstractions.
- Do not edit generated files manually (`docs/css/output.css`).
- Avoid creating new markdown docs unless explicitly requested.

## Project Overview
Runewerk is a static company site served from `docs/` and deployed with GitHub Pages. The app behaves like an HTMX-powered SPA:
- `docs/index.html` is the shell.
- `docs/components/header.html` is injected on load.
- Page fragments (`welcome.html`, `about.html`, `services.html`, `blog.html`, `contact.html`) are swapped into `#content`.

## Development Commands
```bash
npm run build       # generate blog manifest + compile Tailwind
npm run build:css   # compile CSS only (still auto-generates posts manifest)
npm start           # runs prestart (build) and starts local server on :3000
```

Local URL: `http://localhost:3000`

## Key Files
- `docs/js/darkmode.js`: theme resolution, persistence, icon sync, HTMX re-sync.
- `docs/js/i18n.js`: language state, translation loading, DOM translation pass.
- `docs/js/blog.js`: blog markdown loader (manifest + post rendering).
- `docs/css/styles.css`: Tailwind source + reusable component classes.
- `docs/blog.html`: blog section shell (post list + content target).
- `docs/blog/posts.json`: generated list of markdown post filenames.
- `docs/blog/posts/*.md`: markdown source files for blog entries.
- `scripts/generate-posts-manifest.js`: generates `docs/blog/posts.json` from `docs/blog/posts/*.md`.
- `server.js`: simple Express static server for `docs/`.

## Readability Conventions

### JavaScript
- Put constants/selectors at the top of each file.
- Keep state helpers small and explicit.
- Keep event wiring at the bottom of the file.
- Use early returns to reduce nesting.
- Prefer delegated events for HTMX-injected UI controls.

### HTML Fragments
- Content files under `docs/` should be fragments, not full HTML documents.
- Keep structure semantic (`section`, `article`, headings where useful).
- Use a single semantic root per fragment (`section id="..."`).
- For HTMX navigation links, use `hx-get` + `hx-target="#content"`.
- Use `preload="mouseover"` on nav links for perceived performance.
- For blog posts, add markdown files under `docs/blog/posts/`.
- `docs/blog/posts.json` is generated by `npm run build:posts` (also runs automatically before CSS build/start).
- Post titles are derived from the first markdown H1 (`# Title`).

### CSS
- Use `docs/css/styles.css` as the source of truth.
- Extract repeated utility combinations into named component classes in `@layer components`.
- Current reusable classes include:
  - `nav-link`
  - `icon-button`
  - `language-button`
  - `social-link`
  - `social-link-icon`
  - `social-link-label`
  - `content-image`
  - `console`

## i18n + Theme Behavior
- i18n:
  - language key is stored in `localStorage.language`
  - translations loaded from `docs/js/i18n/{lang}.json`
  - translations re-applied after `htmx:afterSwap`
- dark mode:
  - theme key stored in `localStorage.theme`
  - falls back to system preference when no explicit theme is stored
  - icon updates whenever theme or swapped header state changes

## Validation Checklist
1. Run `npm run build` after edits.
2. Run `npm start`.
3. Verify:
   - navigation swaps content correctly
   - language toggle works on initial load and after navigation
   - dark mode toggle and icon stay in sync
   - blog list loads from `posts.json` and markdown renders in `#blog-content`
